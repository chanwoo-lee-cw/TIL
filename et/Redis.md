# Redis

## Redis란?

> Key-Value 구조의 비관계형 In-Memory 데이터 저장소이다.

DB가 있는데도 Redis를 사용하는 이유로는 DB는 디스크에 데이터를 저장하는 방식이기 때문에 데이터의 유지가 좋지만 조회하는데 시간도 오래 걸리고 자주 조회를 하면 부하가 크다.

그래서 Memory에 올려서 사용하는 Redis가 자주 사용된다. 다만, RAM 특성상 휘발성이기 지나치게 큰 데이터를 올리거나 오래보관하게 된다면 유실될 수가 있다.



## 특징

1. **프로세스로 구축이 가능하다.**

   - Redis는 다른 서버에 설치해놓고 네트워크(IP + Port)를 통해 접근이 가능하다
     - 예를 들면, AWS에 Redis 서버를 구축을 한 다음에 여러 대의 서버가 동일한 Redis를 사용 가능할 수도 있다.

   - 즉, 또 다른 독립적인 서버 프로세스로 구축이 가능하다.
2. **In-Memory, 즉, 메모리 기반 데이터 저장소이다.**
   - Redis는 RAM에 데이터를 저장한다.
     - DB보다 훨씬 빠른 응답 속도를 제공
     - 단, 서버가 종료되거나 지나치게 큰 데이터를 올릴 수 데이터가 사라질 수 있다.
   - Cache나 임시 저장소로 사용하기 적절하다.
3. **"Key-Value" 기반의 데이터 자료형을 사용한다.**
   - 데이터를 저장할 때, Key-Value를 기반으로 데이터를 저장한다.
   - Key를 기반으로 Value를 찾는 구조이다.
   - HashTable 구조라 데이터를 찾는게 매우 빠르다.
     - 시간복잡도 : `O(1)`
4. **다양한 자료형을 제공한다**
   - Value 값으로 String 값만 저장하는 것이 아니라, 다양한 자료형을 저장함으로써 유연하게 사용가능하다.
   - 저장 가능한 자료형(Collection)들:
     - String
     - List
     - Set
     - Sorted Set(ZSet)
     - Stream
     - 등등(Bitmap, Bitfield, hash...)
5. **싱글 쓰레드 사용**
   - 하나의 코어에서 하나의 쓰레드만 사용한다.
   - 즉, 모든 요청을 순차적으로 처리한다.
   - 한번에 하나의 요청만 처리하기 때문에 동시성 문제(race condition)이 발생하지 않는다.
     - 락이 없고, 메모리 기반이라, 싱글 쓰레드에도 불구하고 처리 속도가 매우 빠르다
   - 멀티 쓰레드 Redis는 명령을 처리하는 쓰레드는 한개고, 나머지는 파일을 열고 닫거나 하는걸 비동기로 처리한다.
6. **TTL 기능**
   - Redis에 보관한 데이터에 대해 일정 시간 후에 자동으로 만료되도록 TTL을 설정하는 것이 가능하다.
   - 특정 키에 대해 만료되는 시간을 지정하는 것이 가능하다



## 사용시 주의점

- 싱글 스레드를 사용하기 때문에 처리시간이 긴 요청을 처리하는 경우 장애가 발생한다.
- 메모리 단편화
  - 데이터가 크다면 메모리 단편화가 발생하여 응답속도가 느려질 수 있다.

- 주기적인 모니터링
  - 메모리 사용량이 너무 많으면 성능 저하나 장애로 이어질 수 있기 때문에 주기적으로 메모리를 비워줘야한다.






## 사용 예시

### 캐싱

가장 자주 쓰이는 사례로 분산 환경에서 DB에서 자주 쓰이는 데이터를 Cache로 Redis에 저장한다.

Cache로써 빠른 응답값을 보장하고, TTL 설정으로 만료 시간까지 설정할 수 있다.

### 세션 관리

로그인 세션을 Redis에 저장하고 캐싱한다. 분산 환경에서 유저에게 동일한 환경에 로그인 한 것처럼 느끼게 할 수 있고, TTL 설정으로 제한시간을 설정할 수 있다.

### 분산락

분산 환경에서 특정 데이터에 동시 접근을 방지할 때 사용한다. 싱글 쓰레드 방식이기 때문에 락 자체의 동시성 문제를 방지할 수 있고, TTL을 설정함으로써 일정 시간 후에 락을 해제할 수 있다.

### 부하 관리

특정 사용자가 1분 동안 10번 요청까지만 하게 구현하고 싶다. 할 때도 사용한다. 분산 환경에서 동일한 데이터 저장소로써 이용되기 때문에 모든 환경에서 동일한 제한을 걸 수 있고, 일정 시간 후에 자동으로 만료되게 함으로써 제한하기 좋다.



## 참고 자료

- [https://wildeveloperetrain.tistory.com/21](https://wildeveloperetrain.tistory.com/21)
- [https://stormstudy.tistory.com/50](https://stormstudy.tistory.com/50)
- [https://velog.io/@wnguswn7/Redis란-무엇일까-Redis의-특징과-사용-시-주의점](https://velog.io/@wnguswn7/Redis란-무엇일까-Redis의-특징과-사용-시-주의점)
- [https://junuuu.tistory.com/746](https://junuuu.tistory.com/746)